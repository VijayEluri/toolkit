<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN"
 "http://www.springframework.org/dtd/spring-beans.dtd">
    
<beans>
  <bean id="handlerMapping" 
    class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">            
    <property name="mappings">
      <props>
        <prop key="/albums/**">imageGroupController</prop>
        <prop key="/rolls/**">imageGroupController</prop>
        <prop key="/images/**">imageController</prop>
        <prop key="/import">imageImportController</prop>
        <prop key="/mf/**">imageManifestationController</prop>
        <prop key="/logout">logoutController</prop>
        <prop key="/changePermission">imageAccessController</prop>
        <prop key="/**">fileController</prop>
      </props>
    </property>
  </bean>

  <bean id="jspxViewResolver"
    class="org.springframework.web.servlet.view.UrlBasedViewResolver">
    <property name="prefix"><value>/WEB-INF/jsp/</value></property>
    <property name="suffix"><value>.jspx</value></property>
    <property name="viewClass">
      <value>org.springframework.web.servlet.view.JstlView</value>
    </property>
  </bean>
<!--
  <bean id="jspViewResolver"
    class="org.springframework.web.servlet.view.UrlBasedViewResolver">
    <property name="prefix"><value>/WEB-INF/jsp/</value></property>
    <property name="suffix"><value>.jsp</value></property>
    <property name="viewClass">
      <value>org.springframework.web.servlet.view.JstlView</value>
    </property>
  </bean>
  -->

  <bean id="multipartResolver" 
    class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
    
    <!-- one of the properties available; the maximum file size in bytes -->
    <property name="maxUploadSize">
      <value>10000000</value>
    </property>
  </bean>

  <bean id="fileController"
    class="org.springframework.web.servlet.mvc.ServletForwardingController">
    <property name="servletName">
      <value>fileServlet</value> <!-- set in web.xml -->
    </property>
  </bean>

  <bean id="imageGroupController"
    class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
    <property name="transactionManager">
      <ref local="transactionManager"/>
    </property>
    <property name="target">
      <ref local="imageGroupControllerTarget"/>
    </property>
    <property name="transactionAttributes">
      <props>
        <prop key="handleRequest">PROPAGATION_REQUIRED,readOnly</prop>
      </props>
    </property>
  </bean>

  <bean id="imageGroupControllerTarget"
    class="com.trailmagic.image.ui.ImageGroupController"
    autowire="byName">
  </bean>

  <bean id="logoutController"
    class="com.trailmagic.image.ui.LogoutController">
  </bean>

  <bean id="imageController"
    class="com.trailmagic.image.ui.ImageController">
    <property name="supportedMethods">
      <value>GET</value>
    </property>
    <property name="requireSession">
      <value>false</value>
    </property>
    <property name="cacheSeconds">
      <value>-1</value>
    </property>
    <property name="controllerPath">
      <value>/images</value>
    </property>
  </bean>

  <bean id="imageManifestationController"
    class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
    <property name="transactionManager">
      <ref local="transactionManager"/>
    </property>
    <property name="target">
      <ref local="imageManifestationControllerTarget"/>
    </property>
    <property name="transactionAttributes">
      <props>
        <prop key="handleRequest">PROPAGATION_REQUIRED,readOnly</prop>
      </props>
    </property>
  </bean>

  <bean id="imageManifestationControllerTarget"
    class="com.trailmagic.image.ui.ImageManifestationController">
    <property name="supportedMethods">
      <value>GET,HEAD</value>
    </property>
    <property name="requireSession">
      <value>false</value>
    </property>
    <property name="cacheSeconds">
      <value>864000</value>
    </property>
    <property name="controllerPath">
      <value>/mf</value>
    </property>
  </bean>

  <bean id="imageImportController"
    class="com.trailmagic.image.ui.ImageImportController">
    <property name="commandName">
      <value>imageImportBean</value>
    </property>
    <property name="commandClass">
      <value>com.trailmagic.image.ui.ImageImportBean</value>
    </property>
    <property name="formView">
      <value>imageImportForm</value>
    </property>
    <property name="successView">
      <value>imageImportSuccess</value>
    </property>
    <property name="validateOnBinding">
      <value>false</value>
    </property>
  </bean>

  <bean id="imageAccessController"
    class="com.trailmagic.image.ui.ImageAccessController">
    <property name="commandName">
      <value>imageAccessBean</value>
    </property>
    <property name="commandClass">
      <value>com.trailmagic.image.ui.ImageAccessBean</value>
    </property>
    <property name="formView">
      <value>imageAccessForm</value>
    </property>
    <property name="successView">
      <value>imageAccessSuccess</value>
    </property>
    <property name="imageFactory">
      <ref bean="imageFactory"/>
    </property>
    <property name="imageGroupFactory">
      <ref bean="imageGroupFactory"/>
    </property>
    <property name="imageSecurityFactory">
      <ref bean="imageSecurityFactory"/>
    </property>
  </bean>

  <bean id="imageGroupAddForm"
    class="com.trailmagic.image.ui.ImageGroupAddForm">
    <property name="commandName">
      <value>imageGroup</value>
    </property>
    <property name="commandClass">
      <value>com.trailmagic.image.ImageGroup</value>
    </property>
    <property name="formView">
      <value>imageGroupAdd</value>
    </property>
    <property name="successView">
      <value>imageGroupAddSuccess</value>
    </property>
    <property name="validateOnBinding">
      <value>false</value>
    </property>
    <property name="sessionFactory">
      <ref local="sessionFactory"/>
    </property>
    <property name="userFactory">
      <ref local="userFactory"/>
    </property>
  </bean>

  <bean id="transactionInterceptor" 
    class="org.springframework.transaction.interceptor.TransactionInterceptor">
    <property name="transactionManager">
      <ref bean="transactionManager"/>
    </property>
    <property name="transactionAttributeSource">
      <value>
        com.trailmagic.image.ui.ImageGroupController.handleRequest=PROPAGATION_REQUIRED
      </value>
    </property>
  </bean>
  <!--
  <bean id="albumController"
    class="org.springframework.aop.framework.ProxyFactoryBean">
    <property name="target">
      <ref local="albumControllerTarget"/>
    </property>
    <property name="interceptorNames">
      <list>
        <value>hibernateInterceptor</value>
      </list>
    </property>
  </bean>
  -->
</beans>